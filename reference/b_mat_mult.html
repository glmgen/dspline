<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Multiply by B matrix — b_mat_mult • dspline</title><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multiply by B matrix — b_mat_mult"><meta name="description" content="Multiplies a given vector by B, the extended discrete derivative matrix of a
given order, with respect to given design points."><meta property="og:description" content="Multiplies a given vector by B, the extended discrete derivative matrix of a
given order, with respect to given design points."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dspline</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/dspline.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/glmgen/dspline/tree/main/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multiply by B matrix</h1>
      <small class="dont-index">Source: <a href="https://github.com/glmgen/dspline/blob/main/R/matrix_multiplication.R" class="external-link"><code>R/matrix_multiplication.R</code></a></small>
      <div class="d-none name"><code>b_mat_mult.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Multiplies a given vector by B, the extended discrete derivative matrix of a
given order, with respect to given design points.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">b_mat_mult</span><span class="op">(</span><span class="va">v</span>, <span class="va">k</span>, <span class="va">xd</span>, tf_weighting <span class="op">=</span> <span class="cn">FALSE</span>, transpose <span class="op">=</span> <span class="cn">FALSE</span>, inverse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-v">v<a class="anchor" aria-label="anchor" href="#arg-v"></a></dt>
<dd><p>Vector to be multiplied by B, the extended discrete derivative
matrix.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Order for the extended discrete derivative matrix. Must be &gt;= 0.</p></dd>


<dt id="arg-xd">xd<a class="anchor" aria-label="anchor" href="#arg-xd"></a></dt>
<dd><p>Design points. Must be sorted in increasing order, and have length
at least <code>k+1</code>.</p></dd>


<dt id="arg-tf-weighting">tf_weighting<a class="anchor" aria-label="anchor" href="#arg-tf-weighting"></a></dt>
<dd><p>Should "trend filtering weighting" be used? This is a
weighting of the discrete derivatives that is implicit in trend filtering;
see details for more information. The default is <code>FALSE</code>.</p></dd>


<dt id="arg-transpose">transpose<a class="anchor" aria-label="anchor" href="#arg-transpose"></a></dt>
<dd><p>Multiply by the transpose of B? The default is <code>FALSE</code>.</p></dd>


<dt id="arg-inverse">inverse<a class="anchor" aria-label="anchor" href="#arg-inverse"></a></dt>
<dd><p>Multiply by the inverse of B? The default is <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Product of the extended discrete derivative matrix B and the input
vector <code>v</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The extended discrete derivative matrix of order \(k\), with
respect to design points \(x_1 &lt; \ldots &lt; x_n\), is denoted
\(B^k_n\). It is square, having dimension \(n \times n\). Acting on a
vector \(v\) of function evaluations at the design points, denoted \(v
  = f(x_{1:n})\), it gives the discrete derivatives of \(f\) at the points
\(x_{1:n}\):
$$
  B^k_n v = (\Delta^k_n f) (x_{1:n}).
  $$
The matrix \(B^k_n\) can be constructed recursively as the product of a
diagonally-weighted first difference matrix and \(B^{k-1}_n\); see the
help file for <code><a href="b_mat.html">b_mat()</a></code>, or Section 6.2 of Tibshirani (2020). Therefore,
multiplication by \(B^k_n\) or by its transpose can be performed in
\(O(nk)\) operations based on iterated weighted differences. See Appendix
D of Tibshirani (2020) for details.</p>
<p>The option <code>tf_weighting = TRUE</code> performs multiplication by \(Z^k_n B^k_n\)
where \(Z^k_n\) is an \(n \times n\) diagonal matrix whose top left
\(k \times k\) block equals the identity matrix and bottom right
\((n-k) \times (n-k)\) block equals \(W^k_n\), the latter being a
diagonal weight matrix that is implicit in trend filtering, as explained in
the help file for <code><a href="d_mat_mult.html">d_mat_mult()</a></code>.</p>
<p>Lastly, the matrix \(B^k_n\) has a special <strong>inverse relationship</strong> to the
falling factorial basis matrix \(H^{k-1}_n\) of degree \(k-1\) with
knots in \(x_{k:(n-1)}\); it satisfies:
$$
  Z^k_n B^k_n H^{k-1}_n = I_n,
  $$
where \(Z^k_n\) is the \(n \times n\) diagonal matrix as described
above, and \(I_n\) is the \(n \times n\) identity matrix. This,
combined with the fact that the falling factorial basis matrix has an
efficient recursive representation in terms of weighted cumulative sums,
means that multiplying by \((B^k_n)^{-1}\) or its transpose can be
performed in \(O(nk)\) operations. See Section 6.3 and Appendix D of
Tibshirani (2020) for details.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Tibshirani (2020), "Divided differences, falling factorials, and
discrete splines: Another look at trend filtering and related problems",
Section 6.2.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="discrete_deriv.html">discrete_deriv()</a></code> for discrete differentiation at arbitrary query
points, <code><a href="d_mat_mult.html">d_mat_mult()</a></code> for multiplying by the discrete derivative matrix,
and <code><a href="b_mat.html">b_mat()</a></code> for constructing the extended discrete derivative matrix.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">v</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="b_mat.html">b_mat</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">v</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  0.007399441  0.073350696  0.003107608  0.056100499  0.044067450</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] -0.145242361  0.071599606  0.029137603 -0.092481577  0.022172002</span>
<span class="r-in"><span><span class="fu">b_mat_mult</span><span class="op">(</span><span class="va">v</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  0.007399441  0.073350696  0.003107608  0.056100499  0.044067450</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] -0.145242361  0.071599606  0.029137603 -0.092481577  0.022172002</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Addison Hu, Ryan Tibshirani.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

